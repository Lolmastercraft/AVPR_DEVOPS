<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tu Carrito</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <header>
    <h1>Tu Carrito</h1>
    <nav>
      <a href="/">Volver a la tienda</a>
      <a href="/admin.html">Log in Admin</a>
    </nav>
  </header>
  <main>
    <section id="cart-items"></section>
  </main>
  <footer><p>&copy; 2025 Vinilos Clásicos</p></footer>
  <script>
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const container = document.getElementById('cart-items');
    if (cart.length === 0) {
      container.innerHTML = '<p>Tu carrito está vacío.</p>';
    } else {
      cart.forEach((item, idx) => {
        const art = document.createElement('article');
        art.className = 'vinyl-item';
        art.innerHTML = `
          <h2>${item.nombre}</h2>
          <p>Álbum: ${item.album}</p>
          <p>Autor: ${item.autor}</p>
          <p>Precio: $${item.precio}</p>
          <p>Cantidad disponible: ${item.cantidad}</p>
          <button class="buy">Comprar</button>
          <button class="remove">Eliminar</button>
        `;
        container.appendChild(art);
        art.querySelector('.remove').onclick = () => {
          cart.splice(idx, 1);
          localStorage.setItem('cart', JSON.stringify(cart));
          location.reload();
        };
        art.querySelector('.buy').onclick = async () => {
          const res = await fetch(`/api/comprar/${item.id}`, { method: 'POST' });
          if (res.ok) {
            alert('Compra simulada: unidad descontada');
            item.cantidad -= 1;
            localStorage.setItem('cart', JSON.stringify(cart));
            location.reload();
          } else {
            const err = await res.json();
            alert(err.error || 'No se pudo comprar');
          }
        };
      });
    }
  </script>
</body>
</html>
